<!DOCTYPE html>
<html lang="en">
<head>
  <title>SimpleVideoCompareTool</title>
  <meta charset="UTF-8">

  <link rel="stylesheet" href="BeerSlider.unmin.css">
  <script src="BeerSlider.unmin.js"></script>

  <script src="jquery-3.3.1.min.js"></script>
  <script src="jquery.event.move.js"></script>
  <script src="mp4box.all.js"></script>
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

  <style>
      .dragover {
          background:rgb(193, 225, 255);
      }
      .boxspan {
        display: inline-block;
        width: 100%;
        text-align: center;
        line-height:50px;
      }
      .videoItem {
        flex: 1;
        aspect-ratio: auto;
        border: 1px solid black;
      }
</style>
</head>
<body>

  <div style="margin: 10px;">
      <div style="width: 100%; display: flex; ">
          <div id="drop-zoneL" style="height: 50px; width: 100%; border: thin solid #888888;"><span class="boxspan">Left Video (Please drop your video/folder here)</span></div>
          <div style="width: 20px;"></div>
          <div id="drop-zoneR" style="height: 50px; width: 100%; border: thin solid #888888;"><span class="boxspan">Right Video (Please drop your video/folder here)</span></div>
      </div>
  </div>
  <div style="display: flex;">
    <select id="filesL" style="flex: 1;max-width: 50%;"> 
      <option value="">--fileList--</option>
    </select> 
    <select id="filesR" style="flex: 1;max-width: 50%;"> 
      <option value="">--fileList--</option>
    </select> 
  </div>

  <div id="frameLabel">frame: 0</div>
    <label for="playbackSpeed">Speed:</label>
    <select id="playbackSpeed" name="playbackSpeed" onchange="onPlaybackSpeedChange();">
      <option value="100%">100%</option>
      <option value="50%">50%</option>
      <option value="33%">33%</option>
      <option value="10%">10%</option>
    </select>
  <button type="button" id="buttonPlay" style="height: 30px;" onclick="playSync()">Play</button>
  <button type="button" id="buttonStop" style="height: 30px;" onclick="stopSync()">Stop</button>
  <button type="button" id="buttonPrev" style="height: 30px;" onclick="framePrev()">&lt;= Prev</button>
  <button type="button" id="buttonNext" style="height: 30px;" onclick="frameNext()">Next =&gt;</button>
  <div style="height: 10px;"></div>
  <div>HotKeys( d/f: frame seek )</div>
  <div style="height: 10px;"></div>
  <!-- oninput="onSeekbarChange(this.value)" -->
  <input type="range" min="0" max="100" value="0" id="seekbar" style="width: 100%" onchange="onSeekbarChange(this.value)" >
  <div style="height: 10px;"></div>
  <input type="checkbox" name="Playback Range" id="playbackRange" value="0" onchange="updateUI()">Playback Range<br>
  <div id="playRange" style="margin: 8px;"></div>

  <button type="button" id="compare" style="height: 30px;" onclick="compare()">Compare current frame</button>

  <div style="height: 10px;"></div>
  
  <div class="container" style="display: flex;">
    <video id="LHSImage" class="videoItem" style="width: 49%; border-color: blue;"></video>
    <video id="RHSImage" class="videoItem" style="width: 49%; border-color: red"></video>
  </div>

  <!-- Loupe Feature -->
  <div style="display: flex; justify-content: center; align-items: baseline; position: absolute; left: 0px; top: 0px; z-index: 10;" id="uicontainerL">
    <canvas id="uicanvasL" style="max-width:100%; height:auto;">  
  </div>
  <div style="display: flex; justify-content: center; align-items: baseline; position: absolute; left: 0px; top: 0px; z-index: 10;" id="uicontainerR">
    <canvas id="uicanvasR" style="max-width:100%; height:auto;">
  </div>

  <div style="height: 10px;"></div>
  <div>
    <input type="range" id="loupe" min="64" max="1024" value="512" oninput="onLoupe(this.value)" onchange="onLoupe(this.value)"/>
    <label for="">Loupe Box</label>
  </div>
  
  <div style="height: 10px;"></div>

  <div class="compContainer" style="display: flex; justify-content: center; align-items: center; display: none;">
    <div id="slider" class="beer-slider" data-beer-label=dogs-after.jpg style="border: 1px solid #000000;">
      <img src="dogs-after.jpg" alt="Original man holding beer" id="compR">
      <div class="beer-reveal" data-beer-label="dogs-before.jpg" id="BeforeLabel">
        <img src="dogs-before.jpg" alt="Processed with logo and Lightroom presets" id="compL">
      </div>
    </div>
  </div>

  <div class="compContainer" style="margin:10px; padding:10px; border:1px solid black; display: none;">
  <p>
    <input type="checkbox" name="hide" value="0" onchange="didChangeHideHandle(this.checked)">Hide Handle<br>
    <input type="checkbox" name="hide" value="0" onchange="didChangeDifferenceMode(this.checked)">Difference Mode<br>
  </p>
  </div>

  <script>
    const uicanvasL = document.getElementById('uicanvasL');
    const uicanvasR = document.getElementById('uicanvasR');

    beer = new BeerSlider( document.getElementById( "slider" ) ); 
    
    var dragoverHandler = function(e){
        e.preventDefault();
        $(this).addClass("dragover");
    };
    $("#drop-zoneL").on("dragover", dragoverHandler);
    $("#drop-zoneR").on("dragover", dragoverHandler);

    var dragleaveHandler = function(e){
        e.preventDefault();
        $(this).removeClass("dragover");
    };
    $("#drop-zoneL").on("dragleave", dragleaveHandler);
    $("#drop-zoneR").on("dragleave", dragleaveHandler);
    
    var image_L_idx = "LHSImage";
    var image_R_idx = "RHSImage";

    var videoFrames = 0;
    var busyCounter = 0;
    var currentFrame = 0;
    var playingCount = 0;

    var offScreenCanvas = document.createElement('canvas');

    var mouseL = { x: -1000, y: -1000};
    var mouseR = { x: -1000, y: -1000};
    var dragging = false;
    var loupeSize = 512;

    function onLoupe(value)
    {
      loupeSize = value;
      canvasRender();
    }

    function onMouseDown( event )
    {
      dragging = true;
      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);
      mouseL = getMousePos( uicanvasL, event );
      mouseR = getMousePos( uicanvasR, event );
      canvasRender();
    }
    $(uicanvasL).mousedown(onMouseDown);
    $(uicanvasR).mousedown(onMouseDown);

    $(document).mouseup(function() {
        dragging = false; 
    });

    function getMousePos(canvas, event) {
      var rect = canvas.getBoundingClientRect(),
        scaleX = canvas.width / rect.width,
        scaleY = canvas.height / rect.height;

      return {
        x: (event.pageX - rect.left) * scaleX,
        y: (event.pageY - rect.top) * scaleY
      }
    }
    $(document).mousemove(function(event) {
      if(dragging == false)
      {
        return;
      }
      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);
      mouseL = getMousePos( uicanvasL, event );
      mouseR = getMousePos( uicanvasR, event );
      canvasRender();
    });
    
    function canvasRender()
    {
      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);
      // mouseR = getMousePos( uicanvasR );
      // mouseL = getMousePos( uicanvasL );
      
      const ctxR = uicanvasR.getContext("2d");
      const ctxL = uicanvasL.getContext("2d");
      
      const boxSize = loupeSize;
      const lineWidth = 5;

      // Right
      ctxR.clearRect(0, 0, uicanvasR.width, uicanvasR.height);
      if( 0 < mouseR.x && 0 < mouseR.y && mouseR.x < uicanvasR.width && mouseR.y < uicanvasR.height)
      {
        ctxR.drawImage(videoL, 
          mouseR.x, mouseR.y - boxSize, boxSize, boxSize,
          mouseR.x - boxSize, mouseR.y - boxSize, boxSize, boxSize); 
        
        ctxR.lineWidth = lineWidth;
        ctxR.strokeStyle = "blue";
        ctxR.strokeRect (mouseR.x - boxSize, mouseR.y - boxSize, boxSize, boxSize); // L
  
        ctxR.strokeStyle = "red";
        ctxR.strokeRect (mouseR.x, mouseR.y - boxSize, boxSize, boxSize); // R
      }

      ctxL.clearRect(0, 0, uicanvasL.width, uicanvasL.height);
      if( 0 < mouseL.x && 0 < mouseL.y && mouseL.x < uicanvasL.width && mouseL.y < uicanvasL.height)
      {
        ctxL.drawImage(videoR, 
          mouseL.x - boxSize, mouseL.y - boxSize, boxSize, boxSize,
          mouseL.x, mouseL.y - boxSize, boxSize, boxSize); 
        
        ctxL.lineWidth = lineWidth;
        ctxL.strokeStyle = "blue";
        ctxL.strokeRect (mouseL.x - boxSize, mouseL.y - boxSize, boxSize, boxSize); // L
  
        ctxL.strokeStyle = "red";
        ctxL.strokeRect (mouseL.x, mouseL.y - boxSize, boxSize, boxSize); // R
      }
    }

    function updateCanvasLayout()
    {
      const LC = $("#" + image_L_idx);
      var offsetL = LC.offset();

      $('#uicontainerL')
          .css('left', offsetL.left)
          .css('top', offsetL.top)
          .width (LC.width())
          .height(LC.height());

      const RC = $("#" + image_R_idx);
      var offsetR = RC.offset();

      $('#uicontainerR')
          .css('left', offsetR.left)
          .css('top', offsetR.top)
          .width (RC.width())
          .height(RC.height());

      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);
      uicanvasL.width = videoL.videoWidth;
      uicanvasL.height = videoL.videoHeight;
      uicanvasR.width = videoR.videoWidth;
      uicanvasR.height = videoR.videoHeight;

      canvasRender();
    }
    $(document).ready(function() { 
      $(window).resize(updateCanvasLayout);
      updateCanvasLayout();
    }); 

    let videoElements = {
      '#filesL' : [null],
      '#filesR' : [null],
    }; 

    function scanFiles(item, selection_id) {
     if( item.name.endsWith('.mp4') )
     {
      index = videoElements[selection_id].length;
      videoElements[selection_id].push(item);
      $(selection_id).append($('<option>', { 
        value: index,
        text : item.fullPath 
      }));
     }

      if (item.isDirectory) {
        let directoryReader = item.createReader();
        directoryReader.readEntries((entries) => {
          entries.forEach((entry) => {
            scanFiles(entry, selection_id);
          });
        });
      }
    }

    function onVideoChanged( item, image_idx )
    {
      item.file( ( file ) => {
        var reader = new FileReader();
        reader.onload = function(event) {
          currentFrame = 0;

          const video = document.getElementById(image_idx);
          video.src = event.target.result;
          video.onended = onVideoEnd;
          video.load();
          video.addEventListener('loadeddata', function() {
            updateUI();
          }, false);
        }
        
        reader.readAsDataURL(file);

        const arrayReader = new FileReader();
        arrayReader.onload = function(e) {
            const arrayBuffer = e.target.result;
            const mp4box = new MP4Box.createFile();
            mp4box.onReady = function(info) {
                console.log('Metadata:', info);
                videoFrames = info.tracks[0].nb_samples;
            };
            mp4box.onError = function(e) { console.log(e); };
            arrayBuffer.fileStart = 0;
            mp4box.appendBuffer((arrayBuffer));
            mp4box.flush();
        };
        arrayReader.readAsArrayBuffer(file);
      });
    }

    $('#filesL').on('change', function() {
      if( this.value === "" )
      {
        return;
      }
      let item = videoElements['#filesL'][parseInt(this.value)];
      onVideoChanged( item, image_L_idx );
    });
    $('#filesR').on('change', function() {
      if( this.value === "" )
      {
        return;
      }
      let item = videoElements['#filesR'][parseInt(this.value)];
      onVideoChanged( item, image_R_idx );
    });

    var handleDrop = function(e, image_idx, selector_label, selection_id ) {
        e.preventDefault();

        var file = e.originalEvent.dataTransfer.files[0];

        const supportsWebkitGetAsEntry = 'webkitGetAsEntry' in DataTransferItem.prototype;
        if(supportsWebkitGetAsEntry)
        {
          if( image_idx === image_L_idx )
          {
            $('#filesL').empty();
            $('#filesL').append($('<option>', { 
              value: 0,
              text : "--fileList--",
            }));
            videoElements['#filesL'] = [null];
          }
          else
          {
            $('#filesR').empty();
            $('#filesR').append($('<option>', { 
              value: 0,
              text : "--fileList--",
            }));
            videoElements['#filesR'] = [null];
          }

          let item = event.dataTransfer.items[0].webkitGetAsEntry();

          if (item.isDirectory) {
            scanFiles(item, selection_id);

            return;
          }
        }

        var reader = new FileReader();
        reader.onload = function(event) {
          currentFrame = 0;

          const video = document.getElementById(image_idx);
          video.src = event.target.result;
          video.onended = onVideoEnd;
          video.load();
          video.addEventListener('loadeddata', function() {
            updateUI();
          }, false);
        }
        
        reader.readAsDataURL(file);

        const arrayReader = new FileReader();
        arrayReader.onload = function(e) {
            const arrayBuffer = e.target.result;
            const mp4box = new MP4Box.createFile();
            mp4box.onReady = function(info) {
                console.log('Metadata:', info);
                videoFrames = info.tracks[0].nb_samples;
            };
            mp4box.onError = function(e) { console.log(e); };
            arrayBuffer.fileStart = 0;
            mp4box.appendBuffer((arrayBuffer));
            mp4box.flush();
        };
        arrayReader.readAsArrayBuffer(file);
    };
    function onPlaybackSpeedChange()
    {
      const playbackSpeed = $('[name="playbackSpeed"] option:selected').val();
      const rate = parseInt(playbackSpeed) / 100.0

      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);
      videoL.playbackRate = rate;
      videoR.playbackRate = rate;
    }

    function playSync()
    {
      onPlaybackSpeedChange(); // update rate

      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);

      videoL.play().then(() => {
        playingCount++;
        updateUI();
      },(e) => {
        
      });
      videoR.play().then(() => {
        playingCount++;
        updateUI();
      },(e) => {
        // console.log("e");
      });
    }
    function stopSync()
    {
      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);

      busyCounter++;
      updateUI();

      setTimeout(function() {
        playingCount = 0;

        refleshCurrentTime(videoL);
        videoL.requestVideoFrameCallback( ( x, frame ) => {
          const baseTime = frame.mediaTime;
          const duration = videoL.duration;
          const deltaTime = duration / videoFrames;
          const frameNumber = Math.round(baseTime / deltaTime);
          currentFrame = frameNumber;

          video_seek( videoR, baseTime, () => {
            busyCounter--; 
            updateUI();
          });
        });
        videoL.onpause = null;
      }, 100);
      
      videoL.pause();
      videoR.pause();
    }

    function onVideoEnd()
    {
      playingCount--;

      if( playingCount == 0 )
      {
        setTimeout(playSync, 100);
      }
    }

    function refleshCurrentTime( video )
    {
      const step = video.duration / 3;
      if( video.duration / 2 <= video.currentTime )
      {
        video.currentTime -= step;
        video.currentTime += step;
      }
      else
      {
        video.currentTime += step;
        video.currentTime -= step;
      }
    }

    function video_seek( video, mediaTime, onSeekEnd, isFirst = true )
    {
      const duration = video.duration;
      const deltaTime = duration / videoFrames;

      if( isFirst )
        video.currentTime = mediaTime + 0.01 /* magic number, somehow it is faster */;

      refleshCurrentTime(video);
      video.requestVideoFrameCallback( ( x, frame ) => {
        // console.log("seek " + video.currentTime);

        if( Math.abs(mediaTime - frame.mediaTime) < 0.01 )
        {
          onSeekEnd();
        }
        else
        {
          if( frame.mediaTime < mediaTime )
          {
            video.currentTime += deltaTime;
          }
          else{
            video.currentTime -= deltaTime;
          }
          video_seek( video, mediaTime, onSeekEnd, false );
        }
      });
    }

    // from UI
    function framePrev()
    {
      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);

      const duration = videoL.duration;
      const deltaTime = duration / videoFrames;
      const nextFrame = currentFrame - 1;
      if( nextFrame < 0 )
        return;
      
      busyCounter += 2;
      updateUI();

      // console.log( "currentFrame: " + currentFrame);
      // console.log( "nextFrame   : " + nextFrame);
      // console.log( "curT        : " + videoL.currentTime);
      // console.log( "nextT       : " + nextFrame * deltaTime);
      video_seek( videoR, nextFrame * deltaTime, () =>{ 
        const slider = document.getElementById("seekbar");
        slider.max = Math.round(duration / deltaTime) - 1;
        slider.value = nextFrame;

        currentFrame = nextFrame; busyCounter--; updateUI(); 
      });
      video_seek( videoL, nextFrame * deltaTime, () =>{ busyCounter--; updateUI(); });
    }
    function frameNext()
    {
      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);

      const duration = videoL.duration;
      const deltaTime = duration / videoFrames;
      const nextFrame = currentFrame + 1;
      if( videoFrames <= nextFrame )
        return;
      
      busyCounter += 2;
      updateUI();

      // console.log( "currentFrame: " + currentFrame);
      // console.log( "nextFrame   : " + nextFrame);
      // console.log( "curT        : " + videoL.currentTime);
      // console.log( "nextT       : " + nextFrame * deltaTime);
      video_seek( videoR, nextFrame * deltaTime, () =>{ 
        const slider = document.getElementById("seekbar");
        slider.max = Math.round(duration / deltaTime) - 1;
        slider.value = nextFrame;
        currentFrame = nextFrame; busyCounter--; updateUI(); 
      });
      video_seek( videoL, nextFrame * deltaTime, () =>{ busyCounter--; updateUI(); });
    }

    $( "#playRange" ).slider({
      range: true,
      min: 0,
      max: 100,
      values: [ 25, 75 ],
      slide: function( event, ui ) {
        console.log($( "#playRange" ).slider("values"));
      }
    });
    $( ".ui-slider-range" ).css( "background-color", "blue" );
    $( ".ui-slider-handle" ).css( "background-color", "royalblue" );

    var isQuerying = false;
    const tick = () => {
      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);
      if( isQuerying == false )
      {
        isQuerying = true;

        videoL.requestVideoFrameCallback( ( x, frame ) => {
          if( busyCounter == 0 )
          {
            const baseTime = frame.mediaTime;
            const duration = videoL.duration;
            const deltaTime = duration / videoFrames;
            const frameNumber = Math.round(baseTime / deltaTime);
            
            const slider = document.getElementById("seekbar");
            slider.max = Math.round(duration / deltaTime) - 1;
            slider.value = frameNumber;

            currentFrame = frameNumber;

            updateUI(); 

            const enabledPlaybackRange = $('#playbackRange').is(':checked');
            if( enabledPlaybackRange && 0 < playingCount)
            {
              const theRange = $( "#playRange" ).slider("values");
              const begTime = theRange[0] / 100.0 * duration;
              const endTime = theRange[1] / 100.0 * duration;

              if( endTime < videoL.currentTime )
              {
                videoL.currentTime = begTime;
                videoR.currentTime = begTime;
              }
            }
          }

          isQuerying = false;
        });
      }
      requestAnimationFrame(tick);
    }
    tick();

    function onSeekbarChange( value )
    {
      busyCounter++;
      updateUI();

      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);
      const duration = videoL.duration;
      const deltaTime = duration / videoFrames;
      videoL.currentTime = deltaTime * value;

      refleshCurrentTime(videoL);
      videoL.requestVideoFrameCallback( ( x, frame ) => {
        const baseTime = frame.mediaTime;
        const duration = videoL.duration;
        const deltaTime = duration / videoFrames;
        const frameNumber = Math.round(baseTime / deltaTime);
        currentFrame = frameNumber;

        video_seek( videoR, baseTime, () => {
          console.log("seekend" + busyCounter);
          busyCounter--; updateUI();
        });
      });
    }
    var selector_label_L = "#BeforeLabel";
    var selector_label_R = "#slider";

    $("#drop-zoneL").on("drop", function(e) {
        $(this).removeClass("dragover");
        handleDrop(e, image_L_idx, selector_label_L, '#filesL');
    });
    $("#drop-zoneR").on("drop", function(e) {
        $(this).removeClass("dragover");
        handleDrop(e, image_R_idx, selector_label_R, '#filesR');
    });

    function didChangeHideHandle(value) {
      $('.beer-handle').css('z-index', value ? -1 : 2);
    }
    function didChangeDifferenceMode(value) {
      $('.beer-reveal').css('mix-blend-mode', value ? "difference" : "unset");
    }

    $("#compare").prop('disabled', true);
    $("#buttonPlay").prop('disabled', true);
    $("#buttonStop").prop('disabled', true);
    $("#buttonPrev").prop('disabled', true);
    $("#buttonNext").prop('disabled', true);
    $("#seekbar").prop('disabled', true);

    $("#playRange").hide();
    
    function updateUI()
    {
      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);
      const hasVideo = videoL.videoWidth > 0 && videoR.videoWidth > 0;

      const isBusy = busyCounter !== 0 || hasVideo === false;
      const isPlaying = playingCount > 0;

      $("#buttonPlay").prop('disabled', isBusy || isPlaying);
      $("#buttonStop").prop('disabled', !(hasVideo && isPlaying) || isBusy );
      $("#buttonPrev").prop('disabled', isBusy || isPlaying);
      $("#buttonNext").prop('disabled', isBusy || isPlaying);
      $("#frameLabel").html("frame: " + currentFrame);
      $("#seekbar").prop('disabled', isBusy || isPlaying);

      if( hasVideo )
      {
        $("#compare").prop('disabled', false);
      }

      const enabledPlaybackRange = $('#playbackRange').is(':checked');
      if( enabledPlaybackRange )
      {
        $("#playRange").show();
      }
      else
      {
        $("#playRange").hide();
      }

      updateCanvasLayout();
    }
    
    function compare()
    {
      $(".compContainer").css('display', '');

      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);

      offScreenCanvas.width = videoL.videoWidth;
      offScreenCanvas.height = videoL.videoHeight;
      const context = offScreenCanvas.getContext("2d");
      context.drawImage(videoL, 0, 0, offScreenCanvas.width, offScreenCanvas.height);
      const imageL = offScreenCanvas.toDataURL('image/png');

      $("#compL").unbind("load");
      $("#compL").bind('load', function(){
        beer.init();
      });
      $("#compL").attr("src", imageL);
      // $(selector_label).attr("data-beer-label", file.name);

      context.drawImage(videoR, 0, 0, offScreenCanvas.width, offScreenCanvas.height);
      const imageR = offScreenCanvas.toDataURL('image/png');
      $("#compR").unbind("load");
      $("#compR").bind('load', function(){
        beer.init();
      });
      $("#compR").attr("src", imageR);
    }

    // function flipLR() {
    //   var L = $(selector_image_L).attr("src");
    //   var R = $(selector_image_R).attr("src");
    //   $(selector_image_L).attr("src", R);
    //   $(selector_image_R).attr("src", L);

    //   var L_label = $(selector_label_L).attr("data-beer-label");
    //   var R_label = $(selector_label_R).attr("data-beer-label");
    //   $(selector_label_L).attr("data-beer-label", R_label);
    //   $(selector_label_R).attr("data-beer-label", L_label);
    // }
    document.addEventListener('keydown', function(event) {
      if( 0 < busyCounter )
      {
        return;
      }
      const videoL = document.getElementById(image_L_idx);
      const videoR = document.getElementById(image_R_idx);
      const hasVideo = videoL.videoWidth > 0 && videoR.videoWidth > 0;
      if( !hasVideo )
      {
        return;
      }

      // Left
      if (event.key.toLowerCase() === 'd')
      {
        framePrev();
      }
      // Right
      if (event.key.toLowerCase() === 'f')
      {
        frameNext();
      }

      // space
      if( event.keyCode == 32 )
      {

      }
      // console.log("key" + event.keyCode );
  });
  </script>
</body>
</html>
